<html>
<body>
	<script src="jscpp_page.js"></script>
	<script type="text/javascript">
		function run(code, input){
			var crt = new rt({
				stdio: {
					drain: function() {
						var x = input;
						input = null;
						return x;
					},
					write: function(s) {
						output.value += s;
					}
				},
				includes: {
					iostream: _iostream,
					cctype: _cctype,
					cstring: _cstring,
					cmath: _cmath,
				}
			});
			var interp = new interpreter(crt);
			code = code.toString();
			code = preprocessor(crt, prepast, code);
			var ret = ast.parse(code);
			interp.run(ret);
			ret = crt.getFunc('global', 'main', [])(crt, null, []).v;
			return ret;
		}

		function exe(){
			var code = document.getElementById('code').value;
			var input = document.getElementById('input').value;
			var output = document.getElementById('output');
			output.value = '';
			try{
				var before = new Date().getTime();
				var retcode = run(code, input);
				var ellaps = new Date().getTime() - before;
				output.value += '\nprogram exited with code ' + retcode + ' in '+ellaps+'ms\n';
			}catch(e){
				output.value += e + '\n';
			}
		}
	</script>
	<div style="padding: 5px;">
		Code editor<br/>
		<textarea id="code" rows="30" cols="105">
#include &lt;iostream&gt;
int main() {
    int a;
    cin &gt;&gt; a;
    cout &lt;&lt; a*10 &lt;&lt; endl;
    return 0;
}
</textarea><br/><br/>
		<button onclick="exe()">Run</button><br/>
	</div>
	<div>
		<div style="float: left;padding: 5px;">
			Standard input<br/>
			<textarea id="input" rows="10" cols="50">5</textarea>
		</div>
		<div style="float: left;padding: 8px;">
			Standard output<br/>
			<textarea id="output" rows="10" cols="50"></textarea>
		</div>
	</div>
</body>
</html>